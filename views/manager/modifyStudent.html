<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>学生信息管理系统模板</title>
    <link href="/common/css/StudentStyle.css" rel="stylesheet" type="text/css" />
    <link href="/common/css/jbox.css" rel="stylesheet" type="text/css" />
    <link href="/common/css/ks.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/modal/modal.css">
    <link rel="stylesheet" href="/manager/css/modifyStudent.css">
    <script src="/common/js/jquery-2.1.1.min.js"></script>
</head>
<body>
    <div class="banner">
        <div class="bgh">
            <div class="page">
                <div id="logo">
                    <a href="#">
                        <img src="/common/images/school_logo.png" alt="" width="110" height="70" />
                    </a>
                </div>
                <div class="topxx">
                    {{manager.id}}管理员：{{manager.name}}，欢迎您！
                    <a href="/managers/man/{{manager.id}}">我的信息</a>
                    <a href="User/managerInfor/systemMsge.aspx.html">通知</a>
                    <a href="/exit">安全退出</a>
                </div>
                <div class="blog_nav">
                    <ul>
                         <li><a href="/managers/man/{{manager.id}}">我的信息</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="page">
        <div class="box mtop">
            <div class="leftbox">
                <div class="l_nav2">
                    <div class="ta1">
                        <strong>管理员个人中心</strong>
                        <div class="leftbgbt">
                        </div>
                    </div>
                    <div class="cdlist">
                        <div>
                            <a href="/managers/man/{{manager.id}}">我的信息</a>
                        </div>
                        <div>
                            <a href="javascript:;" id="repairePwd" data-id="{{manager.id}}">修改密码</a>
                        </div>
                    </div>
                    <div class="ta1">
                        <strong>课程管理</strong><div class="leftbgbt2">
                    </div>
                    </div>
                    <div class="cdlist">

                        <div>
                            <a href="/managers/lookcourse">查看课程</a>
                        </div>
                    </div>
                    <div class="ta1">
                        <strong>管理</strong><div class="leftbgbt2">
                    </div>
                    </div>
                    <div class="cdlist">
                        <div>
                            <a href="/managers/findTeacher">查看</a>
                        </div>
                    </div>
                    <div class="ta1">
                        <strong>学生管理</strong><div class="leftbgbt2">
                    </div>
                    </div>
                    <div class="cdlist">
                        <div>
                            <a href="#">查看学生</a>
                        </div>
                    </div>
                    <div class="ta1">
                        <strong>教学质量评价管理</strong><div class="leftbgbt2">
                    </div>
                    </div>
                    <div class="cdlist">
                        <div>
                            <a href="/managers/publish">发布教学质量评价</a>
                        </div>
                        <div>
                            <a href="/managers/addTeachEvaluation">增加教学质量评价</a>
                        </div>
                        <div>
                            <a href="/managers/repareEvaluation">修改教学质量评价内容</a>
                        </div>
                    </div>
                    <div class="ta1">
                        <strong>教师得分</strong><div class="leftbgbt2">
                    </div>
                    </div>
                    <div class="cdlist">
                        <div>
                            <a href="/managers/getallevaluato">教师得分查询</a>
                        </div>
                    </div>
                </div>
            </div>
             <div class="rightbox">
                <div class="cztable">
                    <h2 class="mbx">我的信息 &gt;修改基本信息&nbsp;&nbsp;&nbsp;</h2>
                        <table width="100%" cellpadding="0" cellspacing="0" id="information">
                        <tr>
                            <td width="180" align="right">学号</td>
                            <td  width="80" align="left">
                                <input type="text"  class="inp notDo disabled" id="id" name="id" disabled value="{{manager.student.id}}" >
                            </td>
                        </tr>
                        <tr>
                            <td width="180" align="right">姓名</td>
                            <td width="200" align="left">
                                <input type="text"  class="inp" name="teacherName" id="tname" placeholder="姓名" value="{{manager.student.name}}">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td width="180" align="right">性别</td>
                            <td  width="80" align="left">
                                <input type="text"  class="inp" name="sex" id="sex" placeholder="性别" value="{{manager.student.sex}}">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td width="180" align="right">年龄</td>
                            <td  width="80" align="left">
                                <input type="number"  class="inp"  id="age" name="age"  value="{{manager.student.age}}">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td width="80" align="right">QQ</td>
                            <td  width="80" align="left">
                                <input type="text" class="inp" name="qq" id="qq" placeholder="QQ" value="{{manager.student.qq}}">
                                <span></span>
                            </td>
                        </tr>
                            <tr>
                                <td width="80" align="right">电子邮箱</td>
                                <td  width="80" align="left">
                                    <input type="text" class="inp" name="email" id="email" placeholder="电子邮箱" value="{{manager.student.email}}">
                                    <span></span>
                                </td>
                            </tr>
                        <tr>
                            <td width="80" align="right">联系电话</td>
                            <td  width="80" align="left">
                                <input type="text" class="inp" name="phone" id="phone" placeholder="联系电话" value="{{manager.student.phone}}">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td width="80" align="right">联系电话2</td>
                            <td  width="80" align="left">
                                <input type="text" class="inp" name="phone2" id="phone2" placeholder="联系电话" value="{{manager.student.phone2}}">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td width="80" align="right">联系地址</td>
                            <td  width="80" align="left">
                                <input type="text" class="inp" name="address" id="address" placeholder="联系地址" value="{{manager.student.address}}">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td width="80" align="right">自我介绍</td>
                            <td  width="80" align="left">
                                <input type="text" class="inp" name="introduction" id="introduction" placeholder="自我介绍" value="{{manager.student.introduction}}">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" align="center">
                                <div align="center" >
                                    <button type="submit" id="submit" class="btn" >提交</button>
                                    <a href="{{manager.returnPath}}" type="submit"  id="return" class="btn" >返回</a>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
             </div>
    <div class="modal">
        <img src="/common/images/load.gif" alt="" id="img">
    </div>
    <div class="pwd">
        <div class="pwd_header">
            <h1>修改密码</h1>
            <span class="close">X</span>
        </div>
        <div class="pwd_body">
            <p>
                <label for="username">工号</label>
                <input type="text" name="username" id="username" placeholder="password">
            </p>
            <p>
                <label for="password">新密码</label>
                <input type="password" name="password" id="password" placeholder="password">
                <label class="new_report"></label>
            </p>
            <p>
                <label for="password">确认密码</label>
                <input type="password" name="confirmpassword" id="confirmpassword" placeholder="confirmpassword">
                <label class="confirm_report"></label>
            </p>
        </div>
        <div class="pwd_footer">
            <button class="btn" id="reset">取消</button>
            <button class="btn" id="repaire">修改</button>
        </div>
    </div>
    <script>
        $(function(){
            $("#password").blur(function(){
                var pwd = $(this).val()
                if( pwd.length == 0 || pwd.length < 5){
                    $(".new_report").html("长度不够").addClass("error")
                    return false
                }else{
                    $(".new_report").html("").removeClass("error")

                }
            })
            $("#confirmpassword").blur(function(){
                pwd = $(this).val()
                if( pwd.length == 0 || pwd.length < 5){
                    $(".confirm_report").html("长度不够").addClass("error")
                    return false
                }else{
                    $(".confirm_report").html("").removeClass("error")
                }
            })

            $("#repairePwd").on("click",function(){
                $(".modal").show()
                $($(".pwd")[0]).animate({
                    top:"100px",
                },500)
                var id = parseInt($("#repairePwd").attr("data-id"))
                $("#username").val(id).addClass("disabled").attr("disabled","true")
            })

            function resetClick() {
                $(".modal").hide()
                $($(".pwd")[0]).animate({
                    top:"-400px",
                },500)
                $(".confirm_report").html("").prev("input[type='password']").val("").removeClass("error")
                $(".new_report").html("").prev("input[type='password']").val("").removeClass("error")
            }

            function  closeClick() {
                $(".modal").hide()
                $($(".pwd")[0]).animate({
                    top:"-400px",
                },500)
                $(".confirm_report").html("").prev("input[type='password']").val("").removeClass("error")
                $(".new_report").html("").prev("input[type='password']").val("").removeClass("error")
            }

            function modalClick() {
                $(".modal").hide()
                $($(".pwd")[0]).animate({
                    top:"-400px",
                },500)
                $(".confirm_report").html("").prev("input[type='password']").val("").removeClass("error")
                $(".new_report").html("").prev("input[type='password']").val("").removeClass("error")
            }
            $("#reset").on("click",resetClick)
            $(".close").on("click",closeClick)
            $(".modal").on("click",modalClick)

            function dorepaire(){
                var new_p = $("#password").val()
                var new_c = $("#confirmpassword").val()
                if(new_p !== new_c){
                    $(".new_report").html("两次输入密码不同").addClass("error")
                    $(".confirm_report").html("两次输入密码不同").addClass("error")
                    return
                }
                $("#repaire").off("click").addClass("notDo")
                $("#reset").addClass("notDo").off("click")
                $(".close").off("click")
                $(".modal").off("click")
                $(".new_report").html("").removeClass("error")
                $(".confirm_report").html("").removeClass("error")
                var id = parseInt($("#repairePwd").attr("data-id"))
                $.ajax({
                    url:"/teachers/dorepaire",
                    type:"post",
                    data:{id:id,newpassword:new_p,confirmpassword:new_c},
                    dataType:"json",
                    processData:true,
                    traditional:true,
                    success:function(res){
                        console.log(res)
                        if(res.status == 200){
                            setTimeout(function(){
                                alert("修改成功")
                                $("#repaire").removeClass("notDo").on("click",dorepaire)
                                $("#reset").on("click",resetClick).removeClass("notDo")
                                $(".close").on("click",closeClick)
                                $(".modal").on("click",modalClick)
                                modalClick()
                            },2000)
                        }
                    },
                    error:function(err){
                        if(err){
                            alert("修改失败")
                            $("#repaire").removeClass("notDo").on("click",dorepaire)
                            $("#reset").on("click",resetClick).removeClass("notDo")
                            $(".close").on("click",closeClick)
                            $(".modal").on("click",modalClick)
                        }
                    }
                })
            }
            $("#repaire").on("click",dorepaire)

            $("#departement").change(function(){
              var did = parseInt($(this).val())
                $.ajax({
                    url:"/managers/getCourse",
                    type:"post",
                    data:{did},
                    dataType:"json",
                    accepts:"application/json",
                    traditional:false,
                    processData:true,
                    success:function(res){
                       if(res.status === 200){
                           var  html =  `
                                        <option value="">---课程名---</option>
                                    `
                           for(var i=0;i<res.data.length;i++){
                               html += `
                                        <option value="${res.data[i].id}">${res.data[i].name}</option>
                                    `
                           }
                            $("#course").html(html)
                       }
                    },
                    error:function(err){
                        console.log(err)
                    }
                })
            })

            $("#course").change(function(){

                var cid = $(this).val()
                var did = $("#departement").val()
                $.ajax({
                    url:"/managers/getDepartmentCourse",
                    type:"post",
                    data:{cid,did},
                    dataType:"json",
                    accepts:"application/json",
                    traditional:false,
                    processData:true,
                    success:function(res){
                        if(res.status === 200){
                            var html = `
                                 <tr>
                                    <th align="center" width="80">课程ID</th>
                                    <th align="center" width="80">课程名</th>
                                    <th align="center" width="80">所属系</th>
                                </tr>
                            `
                            for(var i=0; i < res.data.length;i++){
                                html += `
                                     <tr>
                                        <td align="center" width="80">${res.data[i].courseID}</td>
                                        <td align="center" width="80">${res.data[i].course}</td>
                                        <td align="center" width="80">${res.data[i].department}</td>
                                    </tr>
                                `
                            }
                            $("#information").html("").html(html)
                        }
                    },
                    error:function(err){
                        console.log(err)
                    }
                })
            })

            $(".filter_inp").keyup(function(){
                var findValue = $(this).val()
                $.ajax({
                    url:"/managers/filterTeacher",
                    type:"post",
                    data:{findValue},
                    dataType:"json",
                    processData:true,
                    accepts:"application/json",
                    success:function(res){
                        if(res.status === 200){
                            // console.log(res.data)
                            var html = `
                                <tr>
                                    <th align="center" width="80">工号</th>
                                    <th align="center" width="80">姓名</th>
                                    <th align="center" width="80">性别</th>
                                    <th align="center" width="80">联系电话</th>
                                    <th align="center" width="80">联系地址</th>
                                    <th align="center" colspan="2" width="100">操作</th>
                                </tr>
                            `
                            for(var i=0;i < res.data.length;i++){
                                html += `
                                     <tr>
                                        <td align="center" width="80">${res.data[i]["id"]}</td>
                                        <td align="center" width="80">${res.data[i]["teachername"]}</td>
                                        <td align="center" width="80">${res.data[i]["teacherSex"]}</td>
                                        <td align="center" width="80">${res.data[i]["teacherPhone"]}</td>
                                        <td align="center" width="80">${res.data[i]["address"]}</td>
                                        <td align="center" width="50"><a href="/managers/modify/teacher/${res.data[i]["id"]}" class="btn_op" id="btn_rapire" >修改</a></td>
                                        <td align="center" width="50"><a href="/managers/detail/teacher/${res.data[i]["id"]}" class="btn_op" id="btn_look" >查看详情</a></td>
                                    </tr>

                                `
                            }
                            $("#information").html("").html(html)
                        }
                    },
                    error:function(err){
                        console.log(err)
                    }
                })
            })

            window.flag = {
                qqFlag:{
                    flag:1,
                    id:'qq',
                    err:"qq不合法"
                },
                emailFlag:{
                    flag:1,
                    id:'email',
                    err:"email不合法"
                },
                tnameFlag:{
                    flag:1,
                    id:'tname',
                    err:"名字不合法"
                },
                sexFlag:{
                    flag:1,
                    id:'sex',
                    err:"性别不合法"
                },
                ageFlag:{
                    flag:1,
                    id:'age',
                    err:"年龄不合法"
                },
                phoneFlag:{
                    flag:1,
                    id:'phone',
                    err:"电话号码不合法"
                },
                phone2Flag:{
                    flag:1,
                    id:'phone2',
                    err:"电话号码不合法"
                },
                addressFlag:{
                    flag:1,
                    id:'address',
                    err:"地址不合法"
                }
            }

            $("#qq").focus(function(){
                $(this).next("span").html("")
            })

            $("#qq").blur(function(){
                var regex = /^[1-9][0-9]{4,10}$/
                var qq = $(this).val()
                if(regex.test(qq) === false){
                    $(this).next("span").html("你输入的qq不合法").css({color:"red"})
                    flag.qqFlag.flag  = 0
                }else{
                    flag.qqFlag.flag  = 1
                }
            })

            $("#email").focus(function(){
                $(this).next("span").html("")
            })

            $("#email").blur(function(){
                var regex = /^[1-9][0-9]{4,10}@([a-z]+|[0-9]+)\.(com|org|edu)$/
                var email = $(this).val()
                if(regex.test(email) === false){
                    $(this).next("span").html("你输入的电子邮箱不合法").css({color:"red"})
                    flag.emailFlag.flag  = 0
                }else{
                    flag.emailFlag.flag  = 1
                }
            })

            $("#tname").focus(function(){
                $(this).next("span").html("")
            })

            $("#tname").blur(function(){
                var regex = /^[\u4e00-\u9fa5]{2,4}$/
                var name = $(this).val()
                if(regex.test(name) === false){
                    $(this).next("span").html("你输入的名字不合法").css({color:"red"})
                    flag.tnameFlag.flag = 0
                }else{
                    flag.tnameFlag.flag = 1
                }
            })

            $("#sex").focus(function(){
                $(this).next("span").html("")
            })

            $("#sex").blur(function(){
                var regex = /^(男|女)$/
                var sex = $(this).val()
                if(regex.test(sex) === false){
                    $(this).next("span").html("你输入的性别不合法").css({color:"red"})
                    flag.sexFlag.flag  = 0
                }else{
                    flag.sexFlag.flag  = 1
                }
            })

            $("#age").focus(function(){
                $(this).next("span").html("")
            })

            $("#age").blur(function(){
                var age = $(this).val()
                var regex
                age = age+""
                if(age.length > 2)
                    regex = /^1[0-4][0-3]$/
                else
                    regex = /^[1-9][0-9]$/
                var reg = new RegExp()
                var r = reg.compile(regex)
                if(r.exec(age) === null){
                    $(this).next("span").html("你输入的年龄不合法").css({color:"red"})
                    flag.ageFlag.flag  = 0
                }else{
                    flag.ageFlag.flag  = 0
                }
            })

            $("#phone").focus(function(){
                $(this).next("span").html("")
            })

            $("#phone").blur(function(){
                var phone = $(this).val()
                var regex
                regex = /^[1-9][0-9]{10}$/
                var reg = new RegExp()
                var r = reg.compile(regex)
                if(phone.length === 0){
                    $(this).next("span").html("你必须输入电话号码").css({color:"red"})
                    flag.phoneFlag.flag  = 0
                }else{
                    flag.phoneFlag.flag  = 1
                }
                if(r.exec(phone) === null){
                    $(this).next("span").html("你必须输入电话号码").css({color:"red"})
                    flag.phoneFlag.flag  = 0
                }else{
                    flag.phoneFlag.flag  = 1
                }
            })

            $("#phone2").focus(function(){
                $(this).next("span").html("")
            })

            $("#phone2").blur(function(){
                var phone2 = $(this).val()
                var regex
                regex = /^[1-9][0-9]{10}$/
                var reg = new RegExp()
                var r = reg.compile(regex)
                if(phone2.length === 0){
                    $(this).next("span").html("你必须输入电话号码").css({color:"red"})
                    flag.phone2Flag.flag  = 0
                }else{
                    flag.phone2Flag.flag  = 1
                }
                if(r.exec(phone2) === null){
                    $(this).next("span").html("你必须输入电话号码").css({color:"red"})
                    flag.phone2Flag.flag  = 0
                }else{
                    flag.phone2Flag.flag  = 1
                }
            })

            $("#address").focus(function(){
                $(this).next("span").html("")
            })

            $("#address").blur(function(){
                var address = $(this).val()
                var regex
                regex = /^([0-9]+|[a-zA-Z]+)$/
                var reg = new RegExp()
                var r = reg.compile(regex)
                if(r.exec(address) !== null){
                    $(this).next("span").html("你输入的地址不合法").css({color:"red"})
                    flag.addressFlag.flag  = 0
                }else{
                    flag.addressFlag.flag  = 1
                }
            })

            $("#submit").on("click",function(){
                var id = $("#id").val()
                var sex = $("#sex").val()
                var tname = $("#tname").val()
                var age = $("#age").val()
                var phone = $("#phone").val()
                var qq = $("#qq").val()
                var address = $("#address").val()
                var email = $("#email").val()
                var phone2 = $("#phone2").val()
                var introduction = $("#introduction").val()
                var execnum = 0
                if($("#phone2").val() === ""){
                    phone2 = ""
                }
                for(var f in flag){
                    for(var f1 in flag[f]){
                        if(flag[f]["flag"] !== 1){
                            let id = `#${flag[f]["id"]}`
                            let err = `${flag[f]["err"]}`
                            $(id).next("span").html(err).css({color:"red"})
                            exec++
                            break;
                        }
                    }
                }
                if(execnum === 8){
                    return
                }
                $(".modal").show()
                $(".modal")[0].style.display = "block"
                $(this).attr("disabled","true").addClass("notDo")
                $(".modal").off("click")
                $.ajax({
                    url:"/managers/domodify/student",
                    type:"post",
                    data:{
                        id:id,
                        sex:sex,
                        age:age,
                        phone:phone,
                        address:address,
                        phone2:phone2,
                        qq:qq,
                        email:email,
                        introduction:introduction,
                        name:tname,
                   },
                    dataType:"json",
                    processData:true,
                    traditional:false,
                    success:function(res){
                        if(res.data.status === 200){
                           setTimeout(function(){
                               $(".modal").hide()
                               $("submit").attr("disabled","false").removeClass("notDo")
                               $(".modal").on("click",modalClick)
                               location.href = res.data.path
                           },3000)
                        }
                    },
                    error:function(err){
                        $(".modal").show()
                        $("submit").attr("disabled","false").removeClass("notDo")
                        $(".modal").on("click",modalClick)
                       console.log(err)
                    }
                })
            })
        })
    </script>
</body>
</html>
